package lift;

public class Person extends Thread {
	private int currentFloor;
	private int targetFloor;
	private Monitor monitor;
	private boolean inElevator;

	public Person(Monitor monitor) {
		inElevator = false;
		this.monitor = monitor;
		currentFloor = (int) (Math.random() * 7);
		targetFloor = nextFloor();
	}

	public void run() {
		monitor.enterFloor(currentFloor);
		while (true) {
			monitor.liftAction();
			if (inElevator && monitor.getCurrentFloor() == targetFloor) {
				monitor.exitLift();
				inElevator = false;
				currentFloor = targetFloor;
				targetFloor = nextFloor();
				try {
					sleep(1000 * ((int) (Math.random() * 46)));
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
				monitor.enterFloor(currentFloor);
			} else if (monitor.canEnter(currentFloor)) {
				monitor.enterLift(targetFloor);
				inElevator = true;
			}
			monitor.waitABit();
		}
	}

	private int nextFloor() {
		int n = (int) (Math.random() * 7);
		while (n == currentFloor) {
			n = (int) (Math.random() * 7);
		}
		return n;
	}
}
